<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hesu Closet | Premium Clothing</title>
    <meta name="description"
        content="Hesu Closet offers the most premium, aesthetic, and modern women's clothing collections in Sri Lanka. Experience high fashion and elegance with us.">
    <meta name="keywords"
        content="Hesu Closet, hesu closet sri lanka, women's clothing, premium fashion, ladies dresses, online shopping sri lanka, high quality dresses for girls, luxury clothing brand">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap"
        rel="stylesheet">

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#ffffff',
                        darker: '#faf9f6',
                        primary: '#d89b9b', // dusty rose pink
                        secondary: '#57534e',
                        borderColor: '#e5e7eb'
                    },
                    fontFamily: {
                        sans: ['"Inter"', 'sans-serif'],
                        serif: ['"Playfair Display"', 'serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 1s ease-out',
                        'slide-up': 'slideUp 0.8s ease-out',
                        'spin-slow': 'spin 1.5s linear infinite',
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .glass { @apply bg-white/70 backdrop-blur-lg border-b border-borderColor; }
            .glass-hover { @apply bg-white/90 shadow-sm border-borderColor; }
        }
        html { scroll-behavior: smooth; }
        body { @apply bg-darker text-secondary font-sans overflow-x-hidden; }
        h1, h2, h3, h4, h5, .font-serif { font-family: 'Playfair Display', serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #faf9f6; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #d89b9b; }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #d89b9b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>

<body class="bg-darker text-stone-800 antialiased">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 transition-all duration-300 glass top-0 left-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex-shrink-0 flex items-center" id="navLogoContainer">
                    <a href="#" class="text-3xl font-serif font-bold tracking-widest text-primary">HESU<span
                            class="text-stone-800 font-light text-xl ml-1">CLOSET</span></a>
                </div>
                <div class="hidden md:flex space-x-8 text-sm uppercase tracking-widest font-medium text-stone-700">
                    <a href="#home" class="hover:text-primary transition-colors duration-300">Home</a>
                    <a href="#collection" class="hover:text-primary transition-colors duration-300">Collection</a>
                    <a href="#about" class="hover:text-primary transition-colors duration-300">About</a>
                </div>
                <div class="flex items-center space-x-6 text-stone-800">
                    <!-- Cart Button -->
                    <button onclick="toggleCart()" class="relative hover:text-primary transition-colors duration-300">
                        <i data-feather="shopping-bag" class="w-5 h-5"></i>
                        <span id="cartCountBadge"
                            class="absolute -top-1 -right-2 bg-primary text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center">0</span>
                    </button>
                    <button class="md:hidden hover:text-primary transition" aria-label="Menu">
                        <i data-feather="menu" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Cart Drawer -->
    <div id="cartOverlay"
        class="fixed inset-0 bg-black/20 z-40 hidden opacity-0 transition-opacity duration-300 backdrop-blur-sm"
        onclick="toggleCart()"></div>
    <div id="cartDrawer"
        class="fixed top-0 right-0 w-full max-w-sm h-full bg-darker border-l border-borderColor z-50 transform translate-x-full transition-transform duration-300 flex flex-col shadow-2xl">
        <div class="p-6 border-b border-borderColor flex justify-between items-center bg-white shadow-sm">
            <h2 class="text-xl font-serif text-primary font-bold">Your Cart</h2>
            <button onclick="toggleCart()" class="text-stone-400 hover:text-stone-800 transition-colors">
                <i data-feather="x" class="w-6 h-6"></i>
            </button>
        </div>

        <div id="cartItemsContainer" class="flex-1 overflow-y-auto p-6 space-y-4"></div>

        <div class="p-6 border-t border-borderColor bg-white">
            <div class="flex justify-between items-center mb-2 text-sm text-stone-600">
                <span>Subtotal</span>
                <span id="cartSubtotal" class="font-medium text-stone-800">Rs 0</span>
            </div>
            <div
                class="flex justify-between items-center mb-4 text-sm text-stone-600 border-b border-dashed border-stone-200 pb-4">
                <span>Delivery Charge</span>
                <span class="font-medium text-stone-800">+ Rs 400</span>
            </div>
            <div class="flex justify-between items-center mb-6 text-lg font-medium">
                <span class="text-stone-800 font-bold">Total</span>
                <span id="cartTotal" class="text-primary font-bold text-xl">Rs 0</span>
            </div>

            <button onclick="openCheckoutModal()"
                class="w-full bg-stone-900 text-white font-bold uppercase tracking-widest text-sm py-4 rounded-sm hover:-translate-y-1 hover:shadow-lg transition-all flex justify-center items-center">
                Secure Checkout <i data-feather="arrow-right" class="w-4 h-4 ml-2"></i>
            </button>
        </div>
    </div>

    <!-- Online Secure Checkout Modal -->
    <div id="checkoutModalOverlay"
        class="fixed inset-0 bg-black/40 z-[60] hidden flex items-center justify-center backdrop-blur-sm p-4">

        <!-- Checkout Form Container -->
        <div id="checkoutFormBox"
            class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden relative transform transition-all scale-95 opacity-0">
            <div class="p-6 border-b border-borderColor flex justify-between items-center bg-stone-50">
                <h2 class="text-2xl font-serif text-stone-800 font-bold flex items-center">
                    <i data-feather="lock" class="w-5 h-5 mr-3 text-primary"></i> Secure Payment
                </h2>
                <button onclick="closeCheckoutModal()" class="text-stone-400 hover:text-red-500 transition-colors"><i
                        data-feather="x" class="w-6 h-6"></i></button>
            </div>

            <div class="p-8 overflow-y-auto flex-1 custom-scrollbar">

                <!-- Order Summary Mini -->
                <div
                    class="mb-8 p-4 bg-stone-50 rounded-lg border border-borderColor flex justify-between items-center">
                    <div>
                        <p class="text-xs text-stone-500 uppercase tracking-widest">Amount to Pay</p>
                        <p id="checkoutDisplayTotal" class="text-2xl font-bold text-primary mt-1">Rs 0</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Shipping Details -->
                    <div>
                        <h3
                            class="text-sm font-bold text-stone-800 uppercase tracking-widest border-b border-borderColor pb-2 mb-4">
                            Shipping Details</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs uppercase text-stone-500 mb-1">Full Name</label>
                                <input type="text" id="chkName" placeholder="Jane Doe"
                                    class="w-full bg-white border border-borderColor px-4 py-2 text-stone-800 focus:border-primary focus:outline-none rounded-md text-sm">
                            </div>
                            <div>
                                <label class="block text-xs uppercase text-stone-500 mb-1">Email (For Receipt)</label>
                                <input type="email" id="chkEmail" placeholder="jane@example.com"
                                    class="w-full bg-white border border-borderColor px-4 py-2 text-stone-800 focus:border-primary focus:outline-none rounded-md text-sm">
                            </div>
                            <div>
                                <label class="block text-xs uppercase text-stone-500 mb-1">Phone Number</label>
                                <input type="text" id="chkPhone" placeholder="+94 7X XXX XXXX"
                                    class="w-full bg-white border border-borderColor px-4 py-2 text-stone-800 focus:border-primary focus:outline-none rounded-md text-sm">
                            </div>
                            <div>
                                <label class="block text-xs uppercase text-stone-500 mb-1">Delivery Address</label>
                                <textarea id="chkAddress" rows="2" placeholder="No 12, Flower Road, Colombo"
                                    class="w-full bg-white border border-borderColor px-4 py-2 text-stone-800 focus:border-primary focus:outline-none rounded-md text-sm"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method & Details -->
                    <div>
                        <h3
                            class="text-sm font-bold text-stone-800 uppercase tracking-widest border-b border-borderColor pb-2 mb-4 flex justify-between items-center">
                            Payment Method
                            <div class="flex gap-1" id="paymentIconBox">
                                <i data-feather="credit-card" class="w-4 h-4 text-stone-400"></i>
                            </div>
                        </h3>

                        <div class="flex gap-2 mb-4">
                            <button id="btnPayCard" onclick="switchPayment('card')"
                                class="flex-1 py-2 text-[10px] font-semibold rounded-md border-2 border-primary bg-primary text-white transition-all uppercase tracking-wider">Card</button>
                            <button id="btnPayBank" onclick="switchPayment('bank')"
                                class="flex-1 py-2 text-[10px] font-semibold rounded-md border-2 border-stone-200 text-stone-500 hover:border-primary hover:text-primary transition-all uppercase tracking-wider">Bank</button>
                            <button id="btnPayCOD" onclick="switchPayment('cod')"
                                class="flex-1 py-2 text-[10px] font-semibold rounded-md border-2 border-stone-200 text-stone-500 hover:border-primary hover:text-primary transition-all uppercase tracking-wider">COD</button>
                        </div>

                        <div id="paymentContentArea"
                            class="space-y-4 bg-stone-50 p-4 rounded-lg border border-borderColor">

                            <!-- Card Mode -->
                            <div id="modeCard" class="space-y-4">
                                <div>
                                    <label class="block text-xs uppercase text-stone-500 mb-1">Carderholder Name</label>
                                    <input type="text" placeholder="Name on card"
                                        class="w-full bg-white border border-borderColor px-4 py-2 text-stone-800 focus:border-primary focus:outline-none rounded-md text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs uppercase text-stone-500 mb-1">Card Number</label>
                                    <input type="text" placeholder="XXXX XXXX XXXX XXXX" maxlength="19"
                                        class="w-full bg-white border border-borderColor px-4 py-2 text-stone-800 focus:border-primary focus:outline-none rounded-md text-sm font-mono tracking-widest">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs uppercase text-stone-500 mb-1">Expiry Date</label>
                                        <input type="text" placeholder="MM/YY" maxlength="5"
                                            class="w-full bg-white border border-borderColor px-4 py-2 text-stone-800 focus:border-primary focus:outline-none rounded-md text-sm text-center">
                                    </div>
                                    <div>
                                        <label class="block text-xs uppercase text-stone-500 mb-1">CVV / CVC</label>
                                        <input type="password" placeholder="•••" maxlength="3"
                                            class="w-full bg-white border border-borderColor px-4 py-2 text-stone-800 focus:border-primary focus:outline-none rounded-md text-sm text-center tracking-widest">
                                    </div>
                                </div>
                            </div>

                            <!-- Bank Mode -->
                            <div id="modeBank" class="hidden space-y-2 text-sm text-stone-600">
                                <p class="text-xs text-stone-500 mb-2">Please transfer the total amount to the following
                                    account. We will process your order upon verification.</p>
                                <p><span class="text-stone-400">Bank:</span> <span id="chkBankName"
                                        class="font-medium text-stone-800">Loading...</span></p>
                                <p><span class="text-stone-400">Acc Name:</span> <span id="chkAccName"
                                        class="font-medium text-stone-800">Loading...</span></p>
                                <p><span class="text-stone-400">Acc No:</span> <span id="chkAccNo"
                                        class="font-medium text-stone-800 font-mono tracking-widest">Loading...</span>
                                </p>
                                <p><span class="text-stone-400">Branch:</span> <span id="chkBranch"
                                        class="font-medium text-stone-800">Loading...</span></p>
                            </div>

                            <!-- COD Mode -->
                            <div id="modeCOD" class="hidden text-sm text-stone-600 space-y-2">
                                <div class="flex items-center font-bold text-stone-800 mb-1">
                                    Cash on Delivery Selected
                                </div>
                                <p class="text-xs text-stone-500 leading-relaxed">You can conveniently pay with cash
                                    when our delivery partner hands over your order at your doorstep. No advance payment
                                    required.</p>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-borderColor bg-stone-50">
                <button id="btnPayNow" onclick="processPayment()"
                    class="w-full bg-primary text-white font-bold uppercase tracking-widest text-sm py-4 rounded-md hover:bg-[#c28484] hover:shadow-lg transition-all flex justify-center items-center">
                    <span id="payBtnText">Pay Now</span>
                    <div id="payBtnSpinner" class="loader ml-3 hidden"></div>
                </button>
                <div class="flex items-center justify-center mt-3 text-xs text-stone-400">
                    <i data-feather="lock" class="w-3 h-3 mr-1"></i> Secured by 256-bit SSL Encryption
                </div>
            </div>
        </div>

        <!-- Success Message Container -->
        <div id="checkoutSuccessBox"
            class="bg-white rounded-xl shadow-2xl w-full max-w-md p-8 text-center relative transform transition-all scale-95 opacity-0 hidden">
            <div
                class="w-20 h-20 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-feather="check" class="w-10 h-10"></i>
            </div>
            <h2 class="text-3xl font-serif text-stone-800 font-bold mb-2">Payment Successful!</h2>
            <p class="text-stone-500 mb-6">Thank you for your order. We have received your payment securely. An email
                receipt has been sent to your invoice email and the order details have been forwarded to Hesu Closet
                Admin.</p>
            <div class="bg-stone-50 p-4 rounded-lg border border-borderColor mb-6 text-sm text-stone-600">
                <p>Order ID: <span class="font-mono font-bold text-stone-800">#HC-2026<span id="randomId"></span></span>
                </p>
            </div>
            <button onclick="closeCheckoutModal(true)"
                class="w-full border-2 border-primary text-primary font-bold uppercase tracking-widest text-sm py-3 rounded-md hover:bg-primary hover:text-white transition-all">
                Continue Shopping
            </button>
        </div>

    </div>

    <!-- Hero Section -->
    <section id="home" class="relative h-screen flex items-center justify-center overflow-hidden">
        <div class="absolute inset-0 w-full h-full">
            <img src="public/images/hero.png" alt="Fashion Models"
                class="w-full h-full object-cover object-center animate-fade-in" />
            <div class="absolute inset-0 bg-gradient-to-t from-darker via-white/30 to-white/10"></div>
        </div>
        <div class="relative z-10 text-center px-4 animate-slide-up max-w-4xl mx-auto mt-20">
            <span class="text-primary tracking-[0.3em] uppercase text-sm font-bold mb-4 block drop-shadow-sm">New
                Arrivals 2026</span>
            <h1 class="text-5xl md:text-8xl font-serif mb-6 leading-tight text-stone-900 drop-shadow-sm">Modern
                <br /><span class="text-primary italic">Elegance.</span>
            </h1>
            <p class="text-stone-800 mb-10 text-lg md:text-xl font-medium max-w-2xl mx-auto drop-shadow-sm">Discover the
                perfect blend of minimalist aesthetic and delicate feminism. Gracefully curated clothing for you.</p>
            <a href="#collection"
                class="px-8 py-4 bg-primary text-white font-semibold uppercase tracking-widest text-sm hover:opacity-90 transition-all duration-300 transform hover:scale-105 rounded-sm inline-block shadow-md">Shop
                Collection</a>
        </div>
    </section>

    <!-- Collection Section -->
    <section id="collection" class="py-24 bg-darker relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-serif mb-4 text-stone-800">Trending Now</h2>
                <div class="h-1 w-20 bg-primary mx-auto mb-6"></div>
                <p class="text-stone-500 font-light max-w-lg mx-auto">Handpicked pieces defining the season's boldest
                    looks. Wear your confidence beautifully.</p>
            </div>
            <div id="productGrid" class="grid grid-cols-1 md:grid-cols-3 gap-10"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact" class="bg-white pt-20 pb-10 border-t border-borderColor">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12 mb-16">
                <div class="col-span-1">
                    <div id="footerLogoContainer">
                        <a href="#"
                            class="text-2xl font-serif font-bold tracking-widest text-primary mb-6 block">HESU<span
                                class="text-stone-800 font-light text-lg ml-1">CLOSET</span></a>
                    </div>
                    <p class="text-stone-500 font-light text-sm mb-6 leading-relaxed">Redefining modern fashion with
                        elegant, premium, and minimalistic designs for the bold and beautiful.</p>
                </div>
                <div class="col-span-1">
                    <h5 class="text-stone-800 uppercase tracking-widest text-sm font-bold mb-6">Contact Us Directly</h5>
                    <ul class="space-y-4 text-stone-500 text-sm font-light">
                        <li class="flex items-center"><i data-feather="phone" class="w-4 h-4 mr-3 text-primary"></i>
                            <span id="dispPhone">Loading...</span>
                        </li>
                        <li class="flex items-center"><i data-feather="mail" class="w-4 h-4 mr-3 text-primary"></i>
                            <span id="dispEmail">Loading...</span>
                        </li>
                        <li class="flex items-center"><i data-feather="map-pin" class="w-4 h-4 mr-3 text-primary"></i>
                            <span id="dispAddress">Loading...</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div
                class="border-t border-borderColor pt-8 flex flex-col md:flex-row justify-center items-center text-xs text-stone-500 font-light">
                <p>&copy; 2026 Hesu Closet. All rights reserved. Secure Payments by HesuPay.</p>
            </div>
        </div>
    </footer>

    <script>
        // Data Load
        if (!localStorage.getItem('products')) {
            localStorage.setItem('products', JSON.stringify([
                { name: 'Floral Summer Dress', price: '6500', category: 'Dresses', image: 'public/images/dress.png', badge: 'New' },
                { name: 'Aesthetic Light Top', price: '3200', category: 'Tops', image: 'public/images/tshirt.png', badge: 'Trending' },
                { name: 'Elegant Skirt', price: '4500', category: 'Bottoms', image: 'public/images/jacket.png', badge: '' }
            ]));
        }
        if (!localStorage.getItem('contact_info')) {
            localStorage.setItem('contact_info', JSON.stringify({
                whatsapp: '94771234567', phone: '+94 77 123 4567', email: 'hello@hesucloset.com', address: 'Colombo, Sri Lanka'
            }));
        }
        if (!localStorage.getItem('bank_info')) {
            localStorage.setItem('bank_info', JSON.stringify({
                name: 'Commercial Bank', accName: 'Hesu Closet', accNo: '10002008XXXX', branch: 'Colombo 07'
            }));
        }

        let cartItems = JSON.parse(localStorage.getItem('cart_items')) || [];
        let chkPaymentMethod = 'card';
        const bankInfo = JSON.parse(localStorage.getItem('bank_info'));

        const siteLogo = localStorage.getItem('site_logo');
        if (siteLogo) {
            document.getElementById('navLogoContainer').innerHTML = `<a href="#"><img src="${siteLogo}" alt="Hesu Closet Logo" class="h-10 object-contain"></a>`;
            document.getElementById('footerLogoContainer').innerHTML = `<a href="#" class="mb-6 block"><img src="${siteLogo}" alt="Hesu Closet Logo" class="h-12 object-contain"></a>`;
        }

        const contactInfo = JSON.parse(localStorage.getItem('contact_info'));
        document.getElementById('dispPhone').textContent = contactInfo.phone;
        document.getElementById('dispEmail').textContent = contactInfo.email;
        document.getElementById('dispAddress').textContent = contactInfo.address;

        const products = JSON.parse(localStorage.getItem('products'));
        const productGrid = document.getElementById('productGrid');

        if (products.length === 0) {
            productGrid.innerHTML = `<p class="text-stone-500 col-span-3 text-center py-10">No items.</p>`;
        } else {
            products.forEach((p, idx) => {
                const badgeHTML = p.badge ? `<div class="absolute top-4 left-4 bg-white/90 text-primary text-xs font-bold px-3 py-1 uppercase tracking-wider rounded-sm z-10 shadow-sm">${p.badge}</div>` : '';
                const card = `
                <div class="group relative overflow-hidden bg-white transform transition-all duration-500 hover:-translate-y-2 rounded-lg cursor-pointer shadow-sm hover:shadow-xl border border-borderColor">
                    <div class="relative h-[500px] overflow-hidden bg-stone-50">
                        <img src="${p.image}" alt="${p.name}" class="w-full h-full object-cover object-center transform transition-transform duration-700 group-hover:scale-110" />
                        ${badgeHTML}
                        <div class="absolute inset-0 bg-white opacity-0 transition-opacity duration-300 group-hover:opacity-20"></div>
                        <div class="absolute bottom-0 left-0 w-full p-6 translate-y-full group-hover:translate-y-0 transition-transform duration-500 ease-in-out glass-hover border-t-0 bg-white shadow-lg">
                            <button id="addBtn-${idx}" onclick="addToCart(${idx})" class="w-full block text-center py-3 bg-primary text-white text-sm uppercase tracking-wider font-semibold hover:opacity-90 transition-opacity rounded-sm">
                                Add to Cart <i data-feather="shopping-bag" class="w-4 h-4 ml-2 inline"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6 text-center">
                        <span class="text-[10px] text-stone-400 font-bold uppercase tracking-widest mb-2 block">${p.category || 'Collection'}</span>
                        <h3 class="text-xl font-serif text-stone-800 mb-2">${p.name}</h3>
                        <p class="text-primary font-bold">Rs ${p.price}</p>
                    </div>
                </div>`;
                productGrid.innerHTML += card;
            });
        }

        function updateCartBadge() { document.getElementById('cartCountBadge').innerText = cartItems.length; }

        function addToCart(index) {
            cartItems.push(products[index]);
            localStorage.setItem('cart_items', JSON.stringify(cartItems));
            updateCartBadge();
            renderCart();
            const btn = document.getElementById(`addBtn-${index}`);
            btn.innerHTML = `Added! <i data-feather="check" class="w-4 h-4 ml-2 inline"></i>`; feather.replace();
            setTimeout(() => { btn.innerHTML = `Add to Cart <i data-feather="shopping-bag" class="w-4 h-4 ml-2 inline"></i>`; feather.replace(); }, 1000);
        }

        function removeFromCart(index) {
            cartItems.splice(index, 1);
            localStorage.setItem('cart_items', JSON.stringify(cartItems));
            updateCartBadge();
            renderCart();
        }

        function toggleCart() {
            const drawer = document.getElementById('cartDrawer');
            const overlay = document.getElementById('cartOverlay');
            if (drawer.classList.contains('translate-x-full')) {
                drawer.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                renderCart();
            } else {
                drawer.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        let finalTotalToPay = 0;

        function renderCart() {
            const container = document.getElementById('cartItemsContainer');
            container.innerHTML = '';
            let subtotal = 0;

            if (cartItems.length === 0) {
                container.innerHTML = `<div class="flex flex-col items-center justify-center h-full text-stone-400"><i data-feather="shopping-bag" class="w-12 h-12 mb-4 opacity-50"></i><p class="text-sm">Your cart is empty.</p></div>`;
                document.getElementById('cartSubtotal').innerText = 'Rs 0';
                document.getElementById('cartTotal').innerText = 'Rs 0';
                finalTotalToPay = 0;
                feather.replace();
                return;
            }

            cartItems.forEach((item, idx) => {
                subtotal += parseInt(item.price);
                container.innerHTML += `
                    <div class="flex items-center gap-4 bg-white p-3 rounded border border-borderColor shadow-sm">
                        <img src="${item.image}" alt="${item.name}" class="w-16 h-20 object-cover rounded-sm border border-borderColor">
                        <div class="flex-1">
                            <h4 class="text-sm font-semibold text-stone-800 leading-tight">${item.name}</h4>
                            <p class="text-primary text-sm font-bold mt-1">Rs ${item.price}</p>
                        </div>
                        <button onclick="removeFromCart(${idx})" class="text-stone-400 hover:text-red-500 transition-colors p-2 bg-stone-50 rounded-full" title="Remove"><i data-feather="x" class="w-4 h-4"></i></button>
                    </div>`;
            });
            finalTotalToPay = subtotal + 400;
            document.getElementById('cartSubtotal').innerText = `Rs ${subtotal}`;
            document.getElementById('cartTotal').innerText = `Rs ${finalTotalToPay}`;
            feather.replace();
        }

        // --- Checkout Modal Logic ---
        function switchPayment(method) {
            chkPaymentMethod = method;
            const btnCard = document.getElementById('btnPayCard');
            const btnBank = document.getElementById('btnPayBank');
            const btnCOD = document.getElementById('btnPayCOD');

            const activeClass = "flex-1 py-2 text-[10px] font-semibold rounded-md border-2 border-primary bg-primary text-white transition-all uppercase tracking-wider";
            const inactiveClass = "flex-1 py-2 text-[10px] font-semibold rounded-md border-2 border-stone-200 text-stone-500 hover:border-primary hover:text-primary transition-all uppercase tracking-wider";

            btnCard.className = (method === 'card') ? activeClass : inactiveClass;
            btnBank.className = (method === 'bank') ? activeClass : inactiveClass;
            btnCOD.className = (method === 'cod') ? activeClass : inactiveClass;

            document.getElementById('modeCard').classList.add('hidden');
            document.getElementById('modeBank').classList.add('hidden');
            document.getElementById('modeCOD').classList.add('hidden');

            const btnPayNowText = document.getElementById('payBtnText');

            if (method === 'card') {
                document.getElementById('modeCard').classList.remove('hidden');
                document.getElementById('paymentIconBox').innerHTML = '<i data-feather="credit-card" class="w-4 h-4 text-stone-400"></i>';
                btnPayNowText.innerText = "Pay Now";
            } else if (method === 'bank') {
                document.getElementById('modeBank').classList.remove('hidden');
                document.getElementById('paymentIconBox').innerHTML = '<i data-feather="briefcase" class="w-4 h-4 text-stone-400"></i>';
                btnPayNowText.innerText = "Place Order";
            } else {
                document.getElementById('modeCOD').classList.remove('hidden');
                document.getElementById('paymentIconBox').innerHTML = '<i data-feather="truck" class="w-4 h-4 text-stone-400"></i>';
                btnPayNowText.innerText = "Place Order";
            }
            feather.replace();
        }

        function openCheckoutModal() {
            if (cartItems.length === 0) return alert('Your cart is empty!');

            // Generate Random Order ID
            document.getElementById('randomId').innerText = Math.floor(1000 + Math.random() * 9000);

            // Populate Bank Details
            if (bankInfo) {
                document.getElementById('chkBankName').innerText = bankInfo.name;
                document.getElementById('chkAccName').innerText = bankInfo.accName;
                document.getElementById('chkAccNo').innerText = bankInfo.accNo;
                document.getElementById('chkBranch').innerText = bankInfo.branch;
            }

            // Display amount
            document.getElementById('checkoutDisplayTotal').innerText = `Rs ${finalTotalToPay}`;

            // Close Cart 
            document.getElementById('cartDrawer').classList.add('translate-x-full');
            document.getElementById('cartOverlay').classList.add('opacity-0');
            setTimeout(() => document.getElementById('cartOverlay').classList.add('hidden'), 300);

            // Open Modal
            const modal = document.getElementById('checkoutModalOverlay');
            const formBox = document.getElementById('checkoutFormBox');

            modal.classList.remove('hidden');
            setTimeout(() => {
                formBox.classList.remove('scale-95', 'opacity-0');
                formBox.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeCheckoutModal(clearCart = false) {
            const modal = document.getElementById('checkoutModalOverlay');
            const formBox = document.getElementById('checkoutFormBox');
            const successBox = document.getElementById('checkoutSuccessBox');

            // Hide elements
            formBox.classList.remove('scale-100', 'opacity-100');
            formBox.classList.add('scale-95', 'opacity-0');
            successBox.classList.remove('scale-100', 'opacity-100');
            successBox.classList.add('scale-95', 'opacity-0');

            setTimeout(() => {
                modal.classList.add('hidden');

                // Reset states
                formBox.classList.remove('hidden');
                successBox.classList.add('hidden');
                document.getElementById('payBtnSpinner').classList.add('hidden');
                document.getElementById('payBtnText').innerText = "Pay Now";
                document.getElementById('btnPayNow').disabled = false;

                if (clearCart) {
                    cartItems = [];
                    localStorage.setItem('cart_items', JSON.stringify(cartItems));
                    updateCartBadge();
                }
            }, 300);
        }

        function processPayment() {
            // Basic validation
            const name = document.getElementById('chkName').value;
            const email = document.getElementById('chkEmail').value;
            if (!name || !email) {
                alert("Please fill your Name and Email for the receipt.");
                return;
            }

            const btn = document.getElementById('btnPayNow');
            const text = document.getElementById('payBtnText');
            const spinner = document.getElementById('payBtnSpinner');

            // Set Loading State
            btn.disabled = true;
            text.innerText = (chkPaymentMethod === 'card') ? "Processing Payment..." : "Processing Order...";
            spinner.classList.remove('hidden');

            // Simulate Network Request for Payment Gateway to User's Bank
            setTimeout(() => {

                /* In a real scenario, this is where we send an API request to Stripe/PayHere and send an email using SendGrid/Node.js */
                console.log(`Email simulated to Admin: ${contactInfo.email} - Order received from ${name}`);
                console.log(`Email simulated to Customer: ${email} - Receipt for Rs ${finalTotalToPay}`);

                // Hide Form, Show Success
                const formBox = document.getElementById('checkoutFormBox');
                const successBox = document.getElementById('checkoutSuccessBox');

                // Update success modal text based on payment method
                if (chkPaymentMethod === 'cod') {
                    successBox.querySelector('h2').innerText = "Order Placed!";
                    successBox.querySelector('p').innerText = "Thank you for shopping with us. Your Cash on Delivery order has been placed. We'll send an email receipt and our admin will contact you shortly.";
                } else if (chkPaymentMethod === 'bank') {
                    successBox.querySelector('h2').innerText = "Order Received!";
                    successBox.querySelector('p').innerText = "Thank you! Please remember to transfer the total amount to our bank account. An invoice with instructions has been sent to your email.";
                } else {
                    successBox.querySelector('h2').innerText = "Payment Successful!";
                    successBox.querySelector('p').innerText = "Thank you for your order. We have received your payment securely. An email receipt has been sent to your invoice email.";
                }

                formBox.classList.remove('scale-100', 'opacity-100');
                formBox.classList.add('scale-95', 'opacity-0');

                setTimeout(() => {
                    formBox.classList.add('hidden');
                    successBox.classList.remove('hidden');

                    setTimeout(() => {
                        successBox.classList.remove('scale-95', 'opacity-0');
                        successBox.classList.add('scale-100', 'opacity-100');
                        feather.replace();
                    }, 50);
                }, 300);

            }, 2500); // 2.5 second fake delay
        }

        updateCartBadge();
        feather.replace();
        window.addEventListener('scroll', () => {
            const nav = document.querySelector('nav');
            if (window.scrollY > 50) { nav.classList.add('bg-white', 'shadow-sm'); nav.classList.remove('bg-white/70', 'backdrop-blur-lg'); }
            else { nav.classList.remove('bg-white', 'shadow-sm'); nav.classList.add('bg-white/70', 'backdrop-blur-lg'); }
        });
    </script>
</body>

</html>